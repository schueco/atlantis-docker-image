---
repos:
- id: /.*/
  workflow: terragrunt
  apply_requirements: [mergeable, approved]
  allow_custom_workflows: true
workflows:
  terragrunt:
    plan:
      steps:
      - env:
          name: TERRAGRUNT_TFPATH
          command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
      - env:
          name: DESTROY_PARAMETER
          command: if [ "$COMMENT_ARGS" = '\-\d\e\s\t\r\o\y' ]; then echo "-destroy"; else echo ""; fi
      - run: terragrunt plan -no-color -out=$PLANFILE $DESTROY_PARAMETER
    apply:
      steps:
      - env:
          name: TERRAGRUNT_TFPATH
          command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
      - run: terragrunt apply -no-color $PLANFILE
